#!/bin/sh -e
#
# Print the CWD of the focused window.
#

# Get focused window ID
id=$(xdpyinfo | grep focus | cut -d' ' -f4)

# Get PID of focused window
pid=$(xprop -id "$id" | grep -m1 PID | cut -d' ' -f3)

# Get last spawned child of focused window process
pid=$(pstree -lpA "$pid" | tail -1 | awk -F'---' '{print $NF}' | sed -r 's/[^0-9]//g')

if [ ! -d "/proc/$pid/cwd" ]; then
    exit 1
fi

readlink -f "/proc/$pid/cwd"
