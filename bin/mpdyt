#!/bin/sh -e
#
# Get current MPD music YouTube URL if available, or a YouTube search
# for the title otherwise.
#

urlencode() {
    curl -sw %{url_effective} --get --data-urlencode "$1" '' | sed 's/..//'
}

extract_url() {
    sed -e 's/.*"webpage_url": "//' -e 's/".*//'
}

file=~/music/$(mpc current -f %file%)
info=$(echo "$file" | sed -r 's/\..+$/.info.json/')

if url=$(cat "$info" | extract_url); then
    echo "$url"
else
    search='https://www.youtube.com/results?search_query='
    echo "$search$(urlencode "$(mpc current)")"
fi
