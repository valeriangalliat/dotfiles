#!/bin/sh -e
#
# Get the title of the focused window, remove potential `user@host`,
# expand `~`, then if it's a valid directory, print the path, otherwise
# exit with `1` status code.
#

focused_title() {
    i3-msg -t get_tree \
        | sed 's/{/{\n/g' \
        | grep -A4 '"focused":true' \
        | tail -1 \
        | sed 's/.*"name":"//;s/",.*//'
}

path=$(focused_title | sed 's/[^:]*: //' | sed "s,^~,$HOME,")

if [ ! -d "$path" ]; then
    exit 1
fi

echo "$path"
