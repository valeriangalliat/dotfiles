#
# ~/.xinitrc
#

#
# Fix for corrupted graphics mostly after suspend/resume when using Intel
# driver.
#
# Wighout this environment variable, some i3 windows would appear totally
# transparent.
#
# From <https://wiki.archlinux.org/index.php/intel_graphics#Font_and_screen_corruption_in_GTK+_applications_(missing_glyphs_after_suspend/resume)>.
#
export COGL_ATLAS_DEFAULT_BLIT_MODE=framebuffer

xrdb -merge "$DOTFILES/x11/Xresources"

if [ -f ~/.Xresources ]; then
    xrdb -merge ~/.Xresources
fi

# Use Mac layout
setxkbmap -variant mac

# Load custom keyboard map (remap left Alt to Ctrl)
xmodmap "$DOTFILES/x11/xmodmaprc"

if [ -f ~/.xmodmaprc ]; then
    xmodmap ~/.xmodmaprc
fi

# Set keyboard repeat delay to 220 instead of default of 660
xset r rate 220

# Auto lock on screen sleep, suspend, hibernate
if command -v xss-lock block; then
    xss-lock -l block &
fi

#
# Auto suspend after 30 minutes of inactivity.
#
# I need to use `xautolock` for this instead of relying on `IdleAction` in
# `/etc/systemd/logind.conf` because the latter doesn't work without a display
# manager. Since I use `startx` without display manager, the idle status is not
# reported to logind for some reason and results in systematic suspend even
# when active.
#
if command -v xautolock; then
  xautolock -time 30 -locker 'systemctl suspend' &
fi

# Execute Compton if available
if command -v compton; then
    compton &
fi

# Execute Redshift if available
if command -v redshift; then
    redshift &
fi

# Window manager
exec i3

# vim: ft=sh
